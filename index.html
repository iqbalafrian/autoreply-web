<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AutoReply</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f4ff;
      color: #003366;
      padding: 20px;
    }
    input, textarea, select, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 100%;
    }
    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background-color: #0056b3;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .template {
      margin-top: 10px;
      padding: 10px;
      background: #e9f0ff;
      border-radius: 8px;
    }
    .flex {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .icon-button {
      background-color: #e0e7ff;
      border: none;
      border-radius: 50%;
      padding: 10px;
      cursor: pointer;
      font-size: 18px;
    }
    .icon-button:hover {
      background-color: #c7d2fe;
    }
    #searchInput {
      display: none;
      margin-left: 10px;
      width: auto;
    }
    svg {
      vertical-align: middle;
    }
    [data-theme='dark'] {
      background-color: #1a1a1a;
      color: #f0f4ff;
    }
    [data-theme='dark'] .card {
      background-color: #2a2a2a;
    }
    [data-theme='dark'] .template {
      background: #333;
      color: #f0f4ff;
    }
    [data-theme='dark'] input,
    [data-theme='dark'] textarea {
      background-color: #2a2a2a;
      color: #f0f4ff;
      border: 1px solid #555;
    }
    [data-theme='dark'] #searchInput {
      background-color: #2a2a2a;
      color: #f0f4ff;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <div>
      <button class="icon-button" onclick="toggleSearch()" title="Cari">
        üè∏
      </button>
      <input type="text" id="searchInput" placeholder="Cari template..." oninput="tampilkanTemplate()"/>
    </div>
    <h1 style="margin: 0;">AutoReply</h1>
    <button class="icon-button" onclick="toggleDarkMode()" title="Mode Gelap/Terang">
      üåì
    </button>
  </div>

  <div class="card">
    <label>Judul Template</label>
    <input type="text" id="judul" placeholder="Contoh: Balasan Otomatis Promo"/>

    <label>Isi Template</label>
    <textarea id="isi" rows="5" placeholder="Tulis isi balasan di sini..."></textarea>

    <button onclick="simpanTemplate()">Simpan Template</button>
  </div>

  <div class="card">
    <h2>Daftar Template</h2>
    <div id="daftarTemplate"></div>
  </div>

<script>
  let templates = [];

  try {
    const stored = JSON.parse(localStorage.getItem("templates"));
    if (Array.isArray(stored)) {
      templates = stored.filter(t => typeof t === 'object' && t.judul && t.isi);
    }
  } catch (e) {
    localStorage.removeItem("templates");
  }

  function simpanTemplate() {
    const judulInput = document.getElementById("judul");
    const isiInput = document.getElementById("isi");
    const judul = judulInput.value.trim();
    const isi = isiInput.value.trim();

    if (!judul || !isi) {
      alert("Judul dan isi harus diisi.");
      return;
    }

    if (templates.some(t => t.judul.toLowerCase() === judul.toLowerCase())) {
      alert("Template dengan judul yang sama sudah ada.");
      return;
    }

    templates.unshift({ judul, isi });
    localStorage.setItem("templates", JSON.stringify(templates));
    judulInput.value = "";
    isiInput.value = "";
    judulInput.focus();
    tampilkanTemplate();
  }

function tampilkanTemplate() {
  const keyword = (document.getElementById("searchInput").value || "").toLowerCase();
  const container = document.getElementById("daftarTemplate");
  container.innerHTML = "";

  const hasil = templates
    .map((t, i) => ({ ...t, index: i }))
    .filter(t => (t.judul?.toLowerCase().includes(keyword) || t.isi?.toLowerCase().includes(keyword)));

  if (hasil.length === 0) {
    container.innerHTML = "<p>Tidak ada template ditemukan.</p>";
    return;
  }

  hasil.forEach(t => {
    const div = document.createElement("div");
    div.className = "template";
    div.style.border = "1px solid #ccc";
    div.style.borderRadius = "10px";
    div.style.marginBottom = "10px";
    div.style.padding = "10px";
    div.style.display = "flex";
    div.style.flexDirection = "row";
    div.style.justifyContent = "space-between";
    div.style.alignItems = "flex-start";

    // Kiri: Judul dan isi template (max 5 baris)
    const kontenKiri = document.createElement("div");
    kontenKiri.style.flex = "1";
    kontenKiri.style.paddingRight = "10px";

    const judulEl = document.createElement("div");
    judulEl.innerHTML = `<strong>${t.judul}</strong>`;
    judulEl.style.marginBottom = "4px";

    const isiEl = document.createElement("div");
    isiEl.innerText = t.isi;
    isiEl.style.maxHeight = "6em"; // 5-6 baris
    isiEl.style.overflow = "hidden";
    isiEl.style.textOverflow = "ellipsis";
    isiEl.style.display = "-webkit-box";
    isiEl.style.webkitLineClamp = "5";
    isiEl.style.webkitBoxOrient = "vertical";
    isiEl.style.whiteSpace = "normal";

    kontenKiri.appendChild(judulEl);
    kontenKiri.appendChild(isiEl);

    // Kanan: Tombol
    const kontenKanan = document.createElement("div");
    kontenKanan.style.display = "flex";
    kontenKanan.style.flexDirection = "column";
    kontenKanan.style.alignItems = "flex-end";
    kontenKanan.style.gap = "4px";

    // Tombol aksi utama
    const salinBtn = document.createElement("button");
    salinBtn.innerText = "Salin";
    salinBtn.onclick = () => salinTemplate(t.isi);

    const editBtn = document.createElement("button");
    editBtn.innerText = "Edit";
    editBtn.onclick = () => mulaiEdit(t.index);

    const hapusBtn = document.createElement("button");
    hapusBtn.innerText = "Hapus";
    hapusBtn.onclick = () => hapusTemplate(t.index);

    const tombolAksi = document.createElement("div");
    tombolAksi.style.display = "flex";
    tombolAksi.style.flexDirection = "column";
    tombolAksi.appendChild(salinBtn);
    tombolAksi.appendChild(editBtn);
    tombolAksi.appendChild(hapusBtn);

    // Tombol reorder
    const naikBtn = document.createElement("button");
    naikBtn.innerText = "üîº";
   naikBtn.onclick = () => naikkanTemplate(t.index);

    const turunBtn = document.createElement("button");
    turunBtn.innerText = "üîΩ";
  turunBtn.onclick = () => turunkanTemplate(t.index);

    const tombolUrutan = document.createElement("div");
    tombolUrutan.style.display = "flex";
    tombolUrutan.style.flexDirection = "column";
    tombolUrutan.style.marginTop = "6px";
    tombolUrutan.appendChild(naikBtn);
    tombolUrutan.appendChild(turunBtn);

    kontenKanan.appendChild(tombolAksi);
    kontenKanan.appendChild(tombolUrutan);

    div.appendChild(kontenKiri);
    div.appendChild(kontenKanan);
    container.appendChild(div);
  });
}
  function naikkanTemplate(index) {
  if (index === 0) return;
  [templates[index - 1], templates[index]] = [templates[index], templates[index - 1]];
  localStorage.setItem("templates", JSON.stringify(templates));
  tampilkanTemplate();
}

function turunkanTemplate(index) {
  if (index === templates.length - 1) return;
  [templates[index], templates[index + 1]] = [templates[index + 1], templates[index]];
  localStorage.setItem("templates", JSON.stringify(templates));
  tampilkanTemplate();
}

  function editTemplate(index, container) {
  const template = templates[index];

  const inputJudul = document.createElement("input");
  inputJudul.value = template.judul;
  inputJudul.style.margin = "4px 0";

  const inputIsi = document.createElement("textarea");
  inputIsi.value = template.isi;
  inputIsi.rows = 3;
  inputIsi.style.margin = "4px 0";

  const simpanBtn = document.createElement("button");
  simpanBtn.innerText = "Simpan";
  simpanBtn.onclick = () => {
    const newJudul = inputJudul.value.trim();
    const newIsi = inputIsi.value.trim();

    if (!newJudul || !newIsi) {
      alert("Judul dan isi tidak boleh kosong.");
      return;
    }

    templates[index] = { judul: newJudul, isi: newIsi };
    localStorage.setItem("templates", JSON.stringify(templates));
    tampilkanTemplate();
  };

  container.innerHTML = "";
  container.appendChild(inputJudul);
  container.appendChild(inputIsi);
  container.appendChild(simpanBtn);
}

  function escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
  }

  function toggleSearch() {
    const input = document.getElementById("searchInput");
    input.style.display = input.style.display === "none" || input.style.display === "" ? "inline-block" : "none";
    if (input.style.display === "inline-block") {
      input.focus();
    }
  }

  function toggleDarkMode() {
    const body = document.body;
    const isDark = body.getAttribute("data-theme") === "dark";
    body.setAttribute("data-theme", isDark ? "light" : "dark");
  }

  tampilkanTemplate();
</script>
