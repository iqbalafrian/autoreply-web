<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AutoReply</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f4ff;
      color: #003366;
      padding: 20px;
    }
    input, textarea, select, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 100%;
    }
    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background-color: #0056b3;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .template {
      margin-top: 10px;
      padding: 10px;
      background: #e9f0ff;
      border-radius: 8px;
    }
    .flex {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .icon-button {
      background-color: #e0e7ff;
      border: none;
      border-radius: 50%;
      padding: 10px;
      cursor: pointer;
      font-size: 18px;
    }
    .icon-button:hover {
      background-color: #c7d2fe;
    }
    #searchInput {
      display: none;
      margin-left: 10px;
      width: auto;
    }
    svg {
      vertical-align: middle;
    }
    [data-theme='dark'] {
      background-color: #1a1a1a;
      color: #f0f4ff;
    }
    [data-theme='dark'] .card {
      background-color: #2a2a2a;
    }
    [data-theme='dark'] .template {
      background: #333;
      color: #f0f4ff;
    }
    [data-theme='dark'] input,
    [data-theme='dark'] textarea {
      background-color: #2a2a2a;
      color: #f0f4ff;
      border: 1px solid #555;
    }
    [data-theme='dark'] #searchInput {
      background-color: #2a2a2a;
      color: #f0f4ff;
    }
    .template p {
  display: -webkit-box;
  -webkit-line-clamp: 5;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  max-height: 7.5em;
  white-space: pre-wrap;
  margin: 10px 0;
}
.template-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 8px;
}
.template-buttons button {
  padding: 4px 8px;
  font-size: 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}
  </style>
</head>
<body>
  <div class="toolbar">
    <div>
      <button class="icon-button" onclick="toggleSearch()" title="Cari">
        üè∏
      </button>
      <input type="text" id="searchInput" placeholder="Cari template..." oninput="tampilkanTemplate()"/>
    </div>
    <h1 style="margin: 0;">AutoReply</h1>
    <button class="icon-button" onclick="toggleDarkMode()" title="Mode Gelap/Terang">
      üåì
    </button>
  </div>

  <div class="card">
    <label>Judul Template</label>
    <input type="text" id="judul" placeholder="Contoh: Balasan Otomatis Promo"/>

    <label>Isi Template</label>
    <textarea id="isi" rows="5" placeholder="Tulis isi balasan di sini..."></textarea>

    <button onclick="simpanTemplate()">Simpan Template</button>
  </div>

  <div class="card">
    <h2>Daftar Template</h2>
    <div id="daftarTemplate"></div>
  </div>

<script>
  let templates = [];

  try {
    const stored = JSON.parse(localStorage.getItem("templates"));
    if (Array.isArray(stored)) {
      templates = stored.filter(t => typeof t === 'object' && t.judul && t.isi);
    }
  } catch (e) {
    localStorage.removeItem("templates");
  }

  function simpanTemplate() {
    const judulInput = document.getElementById("judul");
    const isiInput = document.getElementById("isi");
    const judul = judulInput.value.trim();
    const isi = isiInput.value.trim();

    if (!judul || !isi) {
      alert("Judul dan isi harus diisi.");
      return;
    }

    if (templates.some(t => t.judul.toLowerCase() === judul.toLowerCase())) {
      alert("Template dengan judul yang sama sudah ada.");
      return;
    }

    templates.unshift({ judul, isi });
    localStorage.setItem("templates", JSON.stringify(templates));
    judulInput.value = "";
    isiInput.value = "";
    judulInput.focus();
    tampilkanTemplate();
  }

 function tampilkanTemplate() {
  const keyword = (document.getElementById("searchInput").value || "").toLowerCase();
  const container = document.getElementById("daftarTemplate");
  container.innerHTML = "";

  const hasil = templates
    .map((t, i) => ({ ...t, index: i }))
    .filter(t => (t.judul?.toLowerCase().includes(keyword) || t.isi?.toLowerCase().includes(keyword)));

  if (hasil.length === 0) {
    container.innerHTML = "<p>Tidak ada template ditemukan.</p>";
    return;
  }

  hasil.forEach(t => {
    const div = document.createElement("div");
    div.className = "template";

    const judulEl = document.createElement("strong");
    judulEl.innerText = t.judul;

    const isiEl = document.createElement("p");
    isiEl.innerText = t.isi;

    const flexBox = document.createElement("div");
    flexBox.className = "flex";

    const salinBtn = document.createElement("button");
    salinBtn.innerText = "Salin";
    salinBtn.onclick = () => salinTemplate(t.isi);

    const hapusBtn = document.createElement("button");
    hapusBtn.innerText = "Hapus";
    hapusBtn.onclick = () => hapusTemplate(t.index);

    const editBtn = document.createElement("button");
    editBtn.innerText = "Edit";
    editBtn.onclick = () => {
      // Ganti judul dan isi menjadi input yang bisa diedit
      const editJudul = document.createElement("input");
      editJudul.value = t.judul;
      editJudul.style.marginTop = "5px";

      const editIsi = document.createElement("textarea");
      editIsi.value = t.isi;
      editIsi.rows = 3;
      editIsi.style.marginTop = "5px";

      const simpanEditBtn = document.createElement("button");
      simpanEditBtn.innerText = "Simpan";
      simpanEditBtn.onclick = () => {
        const newJudul = editJudul.value.trim();
        const newIsi = editIsi.value.trim();

        if (!newJudul || !newIsi) {
          alert("Judul dan isi tidak boleh kosong.");
          return;
        }

        templates[t.index] = { judul: newJudul, isi: newIsi };
        localStorage.setItem("templates", JSON.stringify(templates));
        tampilkanTemplate();
      };

      // Bersihkan div dan masukkan editor
      div.innerHTML = "";
      div.appendChild(editJudul);
      div.appendChild(editIsi);
      div.appendChild(simpanEditBtn);
    };

    flexBox.appendChild(salinBtn);
    flexBox.appendChild(editBtn);
    flexBox.appendChild(hapusBtn);

    div.appendChild(judulEl);
    div.appendChild(isiEl);
    div.appendChild(flexBox);

    container.appendChild(div);
  });
}

  function escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
  }

  function toggleSearch() {
    const input = document.getElementById("searchInput");
    input.style.display = input.style.display === "none" || input.style.display === "" ? "inline-block" : "none";
    if (input.style.display === "inline-block") {
      input.focus();
    }
  }

  function toggleDarkMode() {
    const body = document.body;
    const isDark = body.getAttribute("data-theme") === "dark";
    body.setAttribute("data-theme", isDark ? "light" : "dark");
  }

  tampilkanTemplate();
</script>
