<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AutoReply</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="manifest" href="manifest.json" />
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f4ff;
      color: #003366;
      padding: 20px;
    }
    .template {
  transition: all 0.3s ease;
}
    input, textarea, select, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 100%;
    }
    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background-color: #0056b3;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .template {
      margin-top: 10px;
      padding: 10px;
      background: #e9f0ff;
      border-radius: 8px;
    }
    .flex {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .icon-button {
      background-color: #e0e7ff;
      border: none;
      border-radius: 50%;
      padding: 10px;
      cursor: pointer;
      font-size: 18px;
    }
    .icon-button:hover {
      background-color: #c7d2fe;
    }
    #searchInput {
      display: none;
      margin-left: 10px;
      width: auto;
    }
    svg {
      vertical-align: middle;
    }
    [data-theme='dark'] {
      background-color: #1a1a1a;
      color: #f0f4ff;
    }
    [data-theme='dark'] .card {
      background-color: #2a2a2a;
    }
    [data-theme='dark'] .template {
      background: #333;
      color: #f0f4ff;
    }
    [data-theme='dark'] input,
    [data-theme='dark'] textarea {
      background-color: #2a2a2a;
      color: #f0f4ff;
      border: 1px solid #555;
    }
    [data-theme='dark'] #searchInput {
      background-color: #2a2a2a;
      color: #f0f4ff;
    }
    .template p {
  display: -webkit-box;
  -webkit-line-clamp: 5;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  max-height: 7.5em;
  white-space: pre-wrap;
  margin: 10px 0;
}
.template-buttons {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.template-buttons button {
  flex-shrink: 0;
  padding: 8px 16px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

.template-buttons button:hover {
  opacity: 0.9;
}

.template-card.show {
  opacity: 1;
  transform: translateY(0);
}

.template-card.remove {
  opacity: 0;
  transform: translateX(40px);
}
  </style>
</head>
<body>
  <div class="toolbar">
    <div>
      <button class="icon-button" onclick="toggleSearch()" title="Cari">
        üè∏
      </button>
      <input type="text" id="searchInput" placeholder="Cari template..." oninput="tampilkanTemplate()"/>
    </div>
    <h1 style="margin: 0;">AutoReply</h1>
    <button class="icon-button" onclick="toggleDarkMode()" title="Mode Gelap/Terang">
      üåì
    </button>
  </div>

  <div class="card">
    <label>Judul Template</label>
    <input type="text" id="judul" placeholder="Contoh: Balasan Otomatis Promo"/>

    <label>Isi Template</label>
    <textarea id="isi" rows="5" placeholder="Tulis isi balasan di sini..."></textarea>

    <button onclick="simpanTemplate()">Simpan Template</button>
  </div>

  <div class="card">
    <h2>Daftar Template</h2>
    <div id="daftarTemplate"></div>
  </div>

<script>
  let templates = [];

  try {
    const stored = JSON.parse(localStorage.getItem("templates"));
    if (Array.isArray(stored)) {
      templates = stored.filter(t => typeof t === 'object' && t.judul && t.isi);
    }
  } catch (e) {
    localStorage.removeItem("templates");
  }

  function simpanTemplate() {
    const judulInput = document.getElementById("judul");
    const isiInput = document.getElementById("isi");
    const judul = judulInput.value.trim();
    const isi = isiInput.value.trim();

    if (!judul || !isi) {
      alert("Judul dan isi harus diisi.");
      return;
    }

    if (templates.some(t => t.judul.toLowerCase() === judul.toLowerCase())) {
      alert("Template dengan judul yang sama sudah ada.");
      return;
    }

    templates.unshift({ judul, isi });
    localStorage.setItem("templates", JSON.stringify(templates));
    judulInput.value = "";
    isiInput.value = "";
    judulInput.focus();
    tampilkanTemplate();
  }

function tampilkanTemplate() {
  const daftar = document.getElementById("daftarTemplate");
  const query = document.getElementById("searchInput").value.toLowerCase();
  daftar.innerHTML = "";

  const templates = JSON.parse(localStorage.getItem("templates") || "[]")
    .map((t, i) => ({ ...t, index: i }))
    .filter(t => t.judul.toLowerCase().includes(query) || t.isi.toLowerCase().includes(query));

  templates.forEach(t => {
    const div = document.createElement("div");
    div.className = "template-item";

    const judul = document.createElement("strong");
    judul.innerText = t.judul;

    const isi = document.createElement("p");
    isi.innerText = t.isi;
    isi.style.whiteSpace = "nowrap";
    isi.style.overflow = "hidden";
    isi.style.textOverflow = "ellipsis";

    const copyBtn = document.createElement("button");
    copyBtn.innerText = "Salin";
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(t.isi).catch(() => {
        const textarea = document.createElement("textarea");
        textarea.value = t.isi;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
      });
    };

    const editBtn = document.createElement("button");
    editBtn.innerText = "Edit";
    editBtn.onclick = () => {
      div.innerHTML = ""; // Masuk mode edit

      const editJudul = document.createElement("input");
      editJudul.type = "text";
      editJudul.value = t.judul;
      editJudul.style.marginBottom = "5px";

      const editIsi = document.createElement("textarea");
      editIsi.value = t.isi;
      editIsi.rows = 4;
      editIsi.style.marginBottom = "10px";

      const simpanEditBtn = document.createElement("button");
      simpanEditBtn.innerText = "Simpan Perubahan";
      simpanEditBtn.onclick = () => {
        if (editJudul.value.trim() === "" || editIsi.value.trim() === "") return;

        templates[t.index] = {
          judul: editJudul.value.trim(),
          isi: editIsi.value.trim(),
        };
        localStorage.setItem("templates", JSON.stringify(templates));
        tampilkanTemplate();
      };

      const batalBtn = document.createElement("button");
      batalBtn.innerText = "Batal";
      batalBtn.onclick = () => tampilkanTemplate();

      const tombolWrapper = document.createElement("div");
      tombolWrapper.className = "template-buttons"; // CSS ini atur horizontal
      tombolWrapper.style.display = "flex";
      tombolWrapper.style.gap = "8px";
      tombolWrapper.appendChild(simpanEditBtn);
      tombolWrapper.appendChild(batalBtn);

      div.appendChild(editJudul);
      div.appendChild(editIsi);
      div.appendChild(tombolWrapper);
    };

    const hapusBtn = document.createElement("button");
    hapusBtn.innerText = "Hapus";
    hapusBtn.onclick = () => {
      if (confirm("Hapus template ini?")) {
        const data = JSON.parse(localStorage.getItem("templates") || "[]");
        data.splice(t.index, 1);
        localStorage.setItem("templates", JSON.stringify(data));
        tampilkanTemplate();
      }
    };

    // Tambahkan ke DOM
    div.appendChild(judul);
    div.appendChild(isi);
    div.appendChild(copyBtn);
    div.appendChild(editBtn);
    div.appendChild(hapusBtn);

    daftar.appendChild(div);
  });
}

function salinTemplate(teks) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(teks)
      .then(() => alert("Isi template telah disalin ke clipboard!"))
      .catch(() => fallbackSalin(teks));
  } else {
    fallbackSalin(teks);
  }
}

function fallbackSalin(teks) {
  const area = document.createElement("textarea");
  area.value = teks;
  document.body.appendChild(area);
  area.select();
  try {
    document.execCommand("copy");
    alert("Isi template telah disalin (fallback)!");
  } catch {
    alert("Gagal menyalin.");
  }
  document.body.removeChild(area);
}

function hapusTemplate(index) {
  const container = document.getElementById("daftarTemplate");
  const item = [...container.children].find(child => {
    const strong = child.querySelector("strong");
    return strong && strong.innerText === templates[index].judul;
  });

  if (confirm("Yakin ingin menghapus template ini?")) {
    if (item) item.classList.add("remove");
    setTimeout(() => {
      templates.splice(index, 1);
      localStorage.setItem("templates", JSON.stringify(templates));
      tampilkanTemplate();
    }, 400);
  }
}

  function escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
  }

  function toggleSearch() {
    const input = document.getElementById("searchInput");
    input.style.display = input.style.display === "none" || input.style.display === "" ? "inline-block" : "none";
    if (input.style.display === "inline-block") {
      input.focus();
    }
  }

  function toggleDarkMode() {
    const body = document.body;
    const isDark = body.getAttribute("data-theme") === "dark";
    body.setAttribute("data-theme", isDark ? "light" : "dark");
  }

  tampilkanTemplate();
</script>
